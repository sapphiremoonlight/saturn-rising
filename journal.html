<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title> Journal Entries — Saturn Rising</title>
<link rel="icon" href="assets/images/favicon.ico" type="image/png" />
  <link rel="stylesheet" href="styles/styles.css" />
 <link rel="stylesheet" href="styles/journal.css" />
  <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
 </head>
<body>
<header class="journal-header">
  <div class="journal-logo">
    <img src="assets/images/logo.png" alt="Saturn Rising Logo" />
    <span>Saturn Rising</span>
  </div>
  <nav class="journal-nav">
    <a href="index.html" title="Home"><i class="fas fa-home"></i></a>
    <a href="#" title="Journal" class="active"><i class="fas fa-book"></i></a>
    <a href="calendar.html" title="Calendar"><i class="fas fa-calendar-alt"></i></a>
    <a href="game.html" title="Games"><i class="fas fa-gamepad"></i></a>
    <a href="breathe.html" title="Breathe"><i class="fas fa-wind"></i></a>
  </nav>
</header>

<main class="content">
  <h1>📔 Journal Entries</h1>
 <div class="input-container">
    <input type="text" id="entryTitle" placeholder="Entry Title (optional)" />
    <textarea id="journalText" placeholder="Write your thoughts..."></textarea>
  </div>

  <div class="mood-selector" id="moodSelector"></div>

  <div class="controls">
    <div class="media-choice">
  <select id="mediaTypeSelect" onchange="toggleMediaInput()">
    <option value="none">No Media</option>
    <option value="upload">Upload File</option>
    <option value="url">Paste URL</option>
  </select>
  <input type="file" id="mediaUpload" accept="image/*,audio/*,video/*" style="display: none;" />
  <input type="url" id="mediaURL" placeholder="Paste image/audio/video URL" style="display: none;" />
</div>

    <button onclick="saveEntry()">Save Entry</button>
    <button onclick="showRandomEntry()">🎲 Random Entry</button>
  </div>

  <div class="filters">
    <input type="search" id="searchInput" placeholder="Search by title..." oninput="renderEntries()" />
    <select id="sortSelect" onchange="renderEntries()">
      <option value="date">Sort by Date</option>
      <option value="title">Sort by Title</option>
    </select>
    <select id="moodFilter" onchange="renderEntries()">
      <option value="">Filter by Mood</option>
    </select>
  </div>

  <div id="entries"></div>
<!-- Modal for full entry preview -->
<div id="modalOverlay" onclick="closeModal(event)">
  <div id="modalContent" onclick="event.stopPropagation()">
    <button id="modalCloseBtn" onclick="closeModal()">×</button>
    <!-- Full content will be injected here -->
  </div>
</div>
</main>

<footer class="journal-footer">
    <p>© 2025 Saturn Rising. You are safe and supported here.</p>
</footer>

  <script>// ----------- Data and Constants -----------

const moodEmojis = {
  angry: "😡", average: "😐", happy: "😊", sad: "😢", energetic: "⚡", productive: "✅",
  anxious: "😰", annoyed: "😒", stressed: "😫", drained: "😩", numb: "😶", reflective: "🤔",
  motivated: "💪", comforted: "🤗", focused: "🎯"
};

let selectedMoods = new Set();
let entries = [];

// ----------- DOM references -----------

const moodSelector = document.getElementById("moodSelector");
const moodFilter = document.getElementById("moodFilter");

// ----------- Initialize mood buttons & filter options -----------

for (const mood in moodEmojis) {
  // Mood selection buttons
  const btn = document.createElement("div");
  btn.className = "mood-option";
  btn.title = mood;
  btn.textContent = moodEmojis[mood];
  btn.onclick = () => {
    btn.classList.toggle("selected");
    if (selectedMoods.has(mood)) selectedMoods.delete(mood);
    else selectedMoods.add(mood);
  };
  moodSelector.appendChild(btn);

  // Filter dropdown options
  const opt = document.createElement("option");
  opt.value = mood;
  opt.textContent = mood;
  moodFilter.appendChild(opt);
}

// ----------- Local Storage Helpers -----------

const STORAGE_KEY = "journalEntries";

function saveEntriesToStorage() {
  // localStorage can only store strings, so convert entries to JSON
  localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
}

function loadEntriesFromStorage() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    try {
      entries = JSON.parse(saved);
      // Convert string dates back to Date objects if needed
      entries.forEach(entry => {
        entry.date = new Date(entry.date);
      });
    } catch (e) {
      console.error("Error loading entries from localStorage:", e);
      entries = [];
    }
  }
}

// ----------- Save Entry -----------

function saveEntry() {
  const title = document.getElementById("entryTitle").value.trim();
  const text = document.getElementById("journalText").value.trim();
  const mediaType = document.getElementById("mediaTypeSelect").value;
  const mediaFile = document.getElementById("mediaUpload").files[0];
  const mediaURL = document.getElementById("mediaURL").value.trim();

  if (!title && !text && selectedMoods.size === 0 && !mediaFile && !mediaURL) {
    alert("Please enter something or choose a mood.");
    return;
  }

  const entry = {
    id: Date.now(),
    title,
    text,
    moods: [...selectedMoods],
    date: new Date(),
    media: null
  };

  if (mediaType === "url" && mediaURL) {
    const type = guessMediaTypeFromURL(mediaURL);
    if (!type) {
      alert("Invalid media URL.");
      return;
    }
    entry.media = {
      type,
      data: mediaURL
    };
    entries.unshift(entry);
    saveEntriesToStorage();
    resetForm();
    renderEntries();
  } else if (mediaType === "upload" && mediaFile) {
    const reader = new FileReader();
    reader.onloadend = () => {
      entry.media = {
        type: mediaFile.type,
        data: reader.result
      };
      entries.unshift(entry);
      saveEntriesToStorage();
      resetForm();
      renderEntries();
    };
    reader.readAsDataURL(mediaFile);
  } else {
    entries.unshift(entry);
    saveEntriesToStorage();
    resetForm();
    renderEntries();
  }
}

// ----------- toggle logic to show/hide correct media input -----------

function toggleMediaInput() {
  const mediaType = document.getElementById("mediaTypeSelect").value;
  document.getElementById("mediaUpload").style.display = mediaType === "upload" ? "block" : "none";
  document.getElementById("mediaURL").style.display = mediaType === "url" ? "block" : "none";
}

// ----------- guessing extension from URL -----------

function guessMediaTypeFromURL(url) {
  const ext = url.split('.').pop().toLowerCase();
  if (["jpg", "jpeg", "png", "gif", "webp"].includes(ext)) return "image/*";
  if (["mp3", "wav", "ogg"].includes(ext)) return "audio/*";
  if (["mp4", "webm", "mov"].includes(ext)) return "video/*";
  return null;
}

// ----------- resetting media inputs -----------

document.getElementById("mediaTypeSelect").value = "none";
document.getElementById("mediaUpload").style.display = "none";
document.getElementById("mediaUpload").value = "";
document.getElementById("mediaURL").style.display = "none";
document.getElementById("mediaURL").value = "";



// ----------- Reset form -----------

function resetForm() {
  document.getElementById("entryTitle").value = "";
  document.getElementById("journalText").value = "";
  document.getElementById("mediaUpload").value = "";
  selectedMoods.clear();
  document.querySelectorAll(".mood-option").forEach(el => el.classList.remove("selected"));
}

// ----------- Render media -----------

function renderMedia(media) {
  if (!media) return "";
  if (media.type.startsWith("image")) {
    return `<img src="${media.data}" alt="Attached image" />`;
  } else if (media.type.startsWith("audio")) {
    return `<audio controls src="${media.data}"></audio>`;
  } else if (media.type.startsWith("video")) {
    return `<video controls src="${media.data}"></video>`;
  }
  return "";
}

// ----------- Edit title -----------

function editTitle(id, newTitle) {
  const entry = entries.find(e => e.id === id);
  if (entry) entry.title = newTitle;
}

// ----------- Edit text -----------

function editText(id, newText) {
  const entry = entries.find(e => e.id === id);
  if (entry) entry.text = newText;
}

// ----------- Delete entry -----------

function deleteEntry(id) {
  entries = entries.filter(e => e.id !== id);
  renderEntries();
}

// ----------- Show random entry -----------

function showRandomEntry() {
  if (entries.length === 0) {
    alert("No entries yet!");
    return;
  }
  const random = entries[Math.floor(Math.random() * entries.length)];
  alert(`${random.title || '(No Title)'}:\n\n${random.text}`);
}

// ----------- Open modal with full entry content -----------

function openModal(entryId) {
  const entry = entries.find(e => e.id === entryId);
  if (!entry) return;

  const modalContent = document.getElementById("modalContent");

  modalContent.innerHTML = `
    <button id="modalCloseBtn" onclick="closeModal()">×</button>
    <h2>${entry.title || "(No Title)"}</h2>
    <div class="timestamp">${new Date(entry.date).toLocaleString()}</div>
    <div>${entry.moods.map(m => `<span class="mood-chip">${moodEmojis[m]}</span>`).join(" ")}</div>
    <p style="white-space: pre-wrap; max-height:none; cursor: default;">${entry.text || "(No text)"}</p>
    ${renderMedia(entry.media)}
  `;

  document.getElementById("modalOverlay").style.display = "flex";
}

// ----------- Close modal -----------

function closeModal(event) {
  if (event && event.target.id !== "modalOverlay") return;
  document.getElementById("modalOverlay").style.display = "none";
}

// ----------- Render entries with Edit / Save toggle -----------

function renderEntries() {
  const container = document.getElementById("entries");
  container.innerHTML = "";

  const search = document.getElementById("searchInput").value.toLowerCase();
  const sort = document.getElementById("sortSelect").value;
  const moodFilterValue = document.getElementById("moodFilter").value;

  let filtered = entries.filter(entry => (entry.title || "").toLowerCase().includes(search));
  if (moodFilterValue) {
    filtered = filtered.filter(entry => entry.moods.includes(moodFilterValue));
  }

  if (sort === "title") {
    filtered.sort((a, b) => (a.title || "").localeCompare(b.title || ""));
  } else {
    filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
  }

  for (const entry of filtered) {
    const div = document.createElement("div");
    div.className = "entry";

    div.innerHTML = `
      <h3 contenteditable="false" class="entry-title">${entry.title || "(No Title)"}</h3>
      <div class="timestamp">${new Date(entry.date).toLocaleString()}</div>
      <div>${entry.moods.map(m => `<span class="mood-chip">${moodEmojis[m]}</span>`).join(" ")}</div>
      <p contenteditable="false" class="preview-text">${entry.text}</p>
      ${renderMedia(entry.media)}
     <div class="entry-buttons">
    <button class="edit-btn">Edit</button>
    <button class="delete-btn">Delete</button>
  </div>
    `;

    container.appendChild(div);

    const editBtn = div.querySelector(".edit-btn");
    const deleteBtn = div.querySelector(".delete-btn");
    const titleEl = div.querySelector(".entry-title");
    const textEl = div.querySelector(".preview-text");

    let isEditing = false;

    editBtn.onclick = () => {
      if (!isEditing) {
        titleEl.contentEditable = "true";
        textEl.contentEditable = "true";
        titleEl.focus();
        editBtn.textContent = "Save";
        // Disable modal open on click while editing
        textEl.onclick = null;
        const img = div.querySelector("img");
        if (img) img.onclick = null;
      } else {
        titleEl.contentEditable = "false";
        textEl.contentEditable = "false";
        editBtn.textContent = "Edit";
        editTitle(entry.id, titleEl.textContent.trim());
        editText(entry.id, textEl.textContent.trim());
        // Restore modal open on click
        textEl.onclick = () => openModal(entry.id);
        const img = div.querySelector("img");
        if (img) img.onclick = () => openModal(entry.id);
      }
      isEditing = !isEditing;
    };

    deleteBtn.onclick = () => {
      deleteEntry(entry.id);
    };

    // Enable modal open on preview click if not editing
    textEl.onclick = () => openModal(entry.id);
    const img = div.querySelector("img");
    if (img) img.onclick = () => openModal(entry.id);
  }
}

// Load saved entries on page load
loadEntriesFromStorage();
renderEntries();

</script>
</body>
</html>
